=====================================================================
27.07.2022 13:39:59
Task #34067416
Task contextru.ubs.ssbs.billing.BillingTaskContext@47a412d5[
springServiceName=billingTaskService,
springServiceMethodName=calculateContract,
taskManager=ru.ubs.ssbs.billing.BillingTaskServiceImpl$BillingTaskManager,
threadCount=32,
taskState=WORK,
message=Расчет прошлых периодов,
exchangeFormatId=22122706,
userTaskId=34067416,
rangeCount=2,
rangeStart=0,
organisationDatasourceSchema=ssbs-40211,
inputParameters=ru.ubs.ssbs.domain.ContractCriteria@a96ab47,
goodCount=412,
skipCount=0,
failedCount=0]
=====================================================================
Index 10 out of bounds for length 1

java.lang.ArrayIndexOutOfBoundsException: Index 10 out of bounds for length 1
	at ru.ubs.ssbs.billing.rule.BillingRuleContextHelper.getQuotaFromStringJson(BillingRuleContextHelper.java:70)
	at ru.ubs.ssbs.billing.rule.BillingRuleContextHelper.lambda$getFacilityQuotaFromBuilding$12(BillingRuleContextHelper.java:182)
	at java.base/java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:197)
	at java.base/java.util.stream.ReferencePipeline$2$1.accept(ReferencePipeline.java:179)
	at java.base/java.util.Spliterators$IteratorSpliterator.tryAdvance(Spliterators.java:1856)
	at java.base/java.util.stream.ReferencePipeline.forEachWithCancel(ReferencePipeline.java:129)
	at java.base/java.util.stream.AbstractPipeline.copyIntoWithCancel(AbstractPipeline.java:527)
	at java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:513)
	at java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:499)
	at java.base/java.util.stream.FindOps$FindOp.evaluateSequential(FindOps.java:150)
	at java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.base/java.util.stream.ReferencePipeline.findFirst(ReferencePipeline.java:647)
	at ru.ubs.ssbs.billing.rule.BillingRuleContextHelper.getFacilityQuotaFromBuilding(BillingRuleContextHelper.java:182)
	at ru.ubs.ssbs.billing.rule.BillingRuleContextHelper.getFacilityQuotaFromAllPlace(BillingRuleContextHelper.java:1649)
	at ru.ubs.ssbs.billing.rule.RuleCalcWSByMeteringPointRev2Impl.$anonfun$setQuotaToDischarge$2(RuleCalcWSByMeteringPointRev2Impl.scala:525)
	at scala.collection.StrictOptimizedIterableOps.map(StrictOptimizedIterableOps.scala:100)
	at scala.collection.StrictOptimizedIterableOps.map$(StrictOptimizedIterableOps.scala:87)
	at scala.collection.convert.JavaCollectionWrappers$JListWrapper.map(JavaCollectionWrappers.scala:103)
	at ru.ubs.ssbs.billing.rule.RuleCalcWSByMeteringPointRev2Impl.setQuotaToDischarge(RuleCalcWSByMeteringPointRev2Impl.scala:518)
	at ru.ubs.ssbs.billing.rule.RuleCalcWSByMeteringPointRev2Impl.$anonfun$calculate$23(RuleCalcWSByMeteringPointRev2Impl.scala:671)
	at scala.collection.immutable.List.flatMap(List.scala:293)
	at scala.collection.immutable.List.flatMap(List.scala:79)
	at ru.ubs.ssbs.billing.rule.RuleCalcWSByMeteringPointRev2Impl.calculate(RuleCalcWSByMeteringPointRev2Impl.scala:671)
	at ru.ubs.ssbs.billing.BillingServiceHelper.calculateFacilityRule(BillingServiceHelper.java:259)
	at ru.ubs.ssbs.billing.BillingServiceHelper.calculateFacilityRule(BillingServiceHelper.java:368)
	at ru.ubs.ssbs.billing.BillingTaskServiceImpl.calculateContractItem(BillingTaskServiceImpl.java:1458)
	at ru.ubs.ssbs.billing.BillingTaskServiceImpl.calculateContractItem(BillingTaskServiceImpl.java:1438)
	at ru.ubs.ssbs.billing.BillingTaskServiceImpl.calculateTaskRevise(BillingTaskServiceImpl.java:1401)
	at ru.ubs.ssbs.billing.BillingTaskServiceImpl$5.onObject(BillingTaskServiceImpl.java:1121)
	at ru.ubs.ssbs.billing.BillingTaskServiceImpl$5.onObject(BillingTaskServiceImpl.java:1113)
	at ru.ubs.ssbs.exchange.TaskThreadReader.read(TaskThreadReader.java:31)
	at ru.ubs.ssbs.billing.BillingTaskServiceImpl.handleCalculateTaskRevise(BillingTaskServiceImpl.java:1139)
	at ru.ubs.ssbs.billing.BillingTaskServiceBase.calculateTaskRevise(BillingTaskServiceBase.java:485)
	at jdk.internal.reflect.GeneratedMethodAccessor1401.invoke(Unknown Source)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:333)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:190)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:157)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:99)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:283)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:96)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179)
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:213)
	at jdk.proxy2/jdk.proxy2.$Proxy229.calculateTaskRevise(Unknown Source)
	at jdk.internal.reflect.GeneratedMethodAccessor1400.invoke(Unknown Source)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at ru.ubs.utils.ObjectUtils.invokeMethod(ObjectUtils.java:384)
	at ru.ubs.ssbs.exchange.TaskServiceImpl.evaluateCurrentContextMethod(TaskServiceImpl.java:816)
	at ru.ubs.ssbs.exchange.TaskServiceImpl.executeBySingleThreadContext(TaskServiceImpl.java:851)
	at ru.ubs.ssbs.exchange.TaskServiceImpl.lambda$executeByThreadContext$36(TaskServiceImpl.java:740)
	at ru.ubs.ssbs.utils.TransactionUtils.inTransaction(TransactionUtils.java:23)
	at ru.ubs.ssbs.exchange.TaskServiceImpl.lambda$executeByThreadContext$39(TaskServiceImpl.java:738)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:833)
